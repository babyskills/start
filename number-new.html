<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Имитация звонков</title>
<style>
  body {
    margin: 0;
    background-color: #0A1A20;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    justify-content: center;
    align-items: center;
    padding: 5px 5px 10px;
    box-sizing: border-box;
  }
  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-height: 100vh;
    box-sizing: border-box;
    overflow: auto;
  }
  h1 {
    color: #969DA0;
    font-weight: normal;
    font-size: 1rem;
    margin-bottom: 4px;
    user-select: none;
    height: 20px;
    transition: opacity 0.3s ease, height 0.3s ease, margin-bottom 0.3s ease;
  }
  h1.hidden {
    opacity: 0;
    height: 0;
    margin-bottom: 0;
    overflow: hidden;
  }
  .hint {
    color: #969DA0;
    font-size: 1rem;
    text-align: center;
    margin-bottom: 12px;
    min-height: 1.2em;
    user-select: none;
    transition: color 0.3s ease;
  }
  .hint.valid {
    color: #13AD48;
  }
  .hint.invalid {
    color: #B32E3E;
  }
  .display-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #071217;
    color: #969DA0;
    border-radius: 10px;
    height: 60px;
    width: calc(3 * 60px + 2 * 12px);
    max-width: 100%;
    padding: 10px 12px;
    box-sizing: border-box;
    user-select: none;
    transition: color 0.3s ease;
    margin-bottom: 12px;
    font-weight: 600;
  }
  .display-container.invalid {
    color: #B32E3E;
  }
  .display-container.valid {
    color: #13AD48;
  }
  .number-text {
    font-size: 1.3rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
    user-select: text;
    transition: color 0.3s ease;
  }
  .number-text.invalid {
    color: #B32E3E;
  }
  .number-text.valid {
    color: #13AD48;
  }
  .clear-button {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0 5px;
    display: flex;
    align-items: center;
  }
  .dialer {
    display: grid;
    grid-template-columns: repeat(3, 60px);
    gap: 12px;
    padding: 0;
    width: calc(3 * 60px + 2 * 12px);
    max-width: 100%;
    box-sizing: border-box;
    margin: 0 auto;
    user-select: none;
  }
  .button {
    background-color: #162931;
    color: white;
    font-size: 1.3rem;
    border-radius: 50%;
    width: 60px;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    touch-action: manipulation;
    transition: background-color 0.3s;
  }
  .button:active {
    background-color: #0f1f26;
  }
  .call-button {
    background-color: #13AD48;
    width: 60px;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    grid-column: 2 / 3;
    justify-self: center;
    align-self: center;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .call-button:active {
    background-color: #0e8d37;
  }
  .call-button svg {
    width: 28px;
    height: 28px;
  }
  .popup-overlay {
    position: fixed;
    inset: 0;
    background: #071217;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .popup-overlay.active {
    display: flex;
  }
  .popup-content {
    background: black;
    width: 90vw;
    height: 90vw;
    max-width: 380px;
    max-height: 380px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 22px;
  }
  .popup-content video {
    width: 100%;
    height: 100%;
    border-radius: 22px;
  }
</style>
</head>
<body>
<div class="container" role="main">
  <h1 id="inputTitle">Напечатай мамин номер</h1>
  <div class="hint" id="hint" aria-live="polite" aria-atomic="true"></div>
  <div class="display-container" id="displayContainer" aria-live="polite" aria-atomic="true">
    <span class="number-text" id="numberText"></span>
    <button class="clear-button" id="clearButton" aria-label="Удалить последнюю цифру" title="Удалить последнюю цифру">
      <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <path d="M6.40238 0.68299C6.78216 0.24896 7.33081 0 7.90753 0H21C22.1046 0 23 0.895431 23 2V14C23 15.1046 22.1046 16 21 16H7.90753C7.33081 16 6.78216 15.751 6.40238 15.317L1.15238 9.31701C0.492582 8.56296 0.492584 7.43704 1.15238 6.68299L6.40238 0.68299Z" fill="#5D7B89"/>
        <path d="M17.7675 5.35352L15.121 8L17.7675 10.6465L16.3535 12.0605L13.707 9.41406L11.0605 12.0605L9.64642 10.6465L12.2929 8L9.64642 5.35352L11.0605 3.93945L13.707 6.58594L16.3535 3.93945L17.7675 5.35352Z" fill="white"/>
      </svg>
    </button>
  </div>
  <div class="dialer" role="application" aria-label="Телефонный набор">
    <div class="button" tabindex="0">1</div>
    <div class="button" tabindex="0">2</div>
    <div class="button" tabindex="0">3</div>
    <div class="button" tabindex="0">4</div>
    <div class="button" tabindex="0">5</div>
    <div class="button" tabindex="0">6</div>
    <div class="button" tabindex="0">7</div>
    <div class="button" tabindex="0">8</div>
    <div class="button" tabindex="0">9</div>
    <div class="button" tabindex="0">✱</div>
    <div class="button" tabindex="0">0</div>
    <div class="button" tabindex="0">#</div>
    <div class="call-button" role="button" aria-label="Позвонить" tabindex="0" id="callButton">
      <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M6.86687 4.12058L4.78109 0.915432C4.78109 0.915432 4.32338 0 3.40795 0C2.49251 0 0 1.74703 0 4.42534C0 8.45302 4.37209 13.0324 5.42122 14.0736L5.42348 14.0759L5.42462 14.077L5.42688 14.0793L5.42801 14.0804L5.42915 14.0816L5.43028 14.0827L5.43255 14.085L5.43368 14.0861L5.43481 14.0872L5.43708 14.0895L5.43821 14.0906L5.44048 14.0929L5.44161 14.0952L5.44388 14.0963V14.0974L5.44614 14.0986L5.44727 14.0997L5.44841 14.1008L5.45067 14.1031L5.45181 14.1042V14.1054L5.45294 14.1065H5.45407L5.45521 14.1076C6.43861 15.1046 11.0668 19.5572 15.133 19.5572C17.8113 19.5572 19.5572 17.0658 19.5572 16.1492C19.5572 15.2338 18.6417 14.7761 18.6417 14.7761L15.4377 12.6903C15.4377 12.6903 14.844 12.2326 14.2674 12.2326C12.9112 12.2326 12.6223 14.1156 11.2662 14.1156C10.2726 14.1156 8.36125 12.3889 7.74832 11.81C7.16937 11.1959 5.44274 9.28461 5.44274 8.29101C5.44274 6.93485 7.32459 6.64595 7.32459 5.28979C7.32459 4.71312 6.86687 4.12058 6.86687 4.12058Z" fill="white"/>
      </svg>
    </div>
  </div>
</div>
<div class="popup-overlay" id="popupOverlay" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
  <div class="popup-content">
    <video id="doneVideo" src="mynumber/done.mp4" muted></video>
  </div>
</div>
<script>
  const displayText = document.getElementById('numberText');
  const buttons = document.querySelectorAll('.button');
  const clearButton = document.getElementById('clearButton');
  const displayContainer = document.getElementById('displayContainer');
  const callButton = document.getElementById('callButton');
  const hint = document.getElementById('hint');
  const popupOverlay = document.getElementById('popupOverlay');
  const doneVideo = document.getElementById('doneVideo');
  const inputTitle = document.getElementById('inputTitle');
  let rawNumber = '';

  function formatNumber(num) {
    let digits = num.replace(/\D/g, '').slice(0, 11);
    let formatted = '';
    if(digits.length > 0) formatted += digits[0];
    if(digits.length > 1) formatted += ' ' + digits.slice(1, 4);
    if(digits.length > 4) formatted += ' ' + digits.slice(4, 7);
    if(digits.length > 7) formatted += ' ' + digits.slice(7, 9);
    if(digits.length > 9) formatted += ' ' + digits.slice(9, 11);
    return formatted;
  }

  function isValidNumber(formattedNum) {
    return formattedNum === "8 916 888 88 88";
  }

  function isIncorrectSoFar(formattedNum) {
    if(!formattedNum.startsWith("8")) return true;
    const parts = formattedNum.split(" ");
    if(!parts[0].startsWith("8")) return true;
    const correctNumber = "8 916 888 88 88";
    for(let i=0; i < formattedNum.length; i++){
      if(i >= correctNumber.length) break;
      if(formattedNum[i] !== correctNumber[i]) return true;
    }
    return false;
  }

  function updateDisplay() {
    const formattedNumber = formatNumber(rawNumber);
    displayText.textContent = formattedNumber;

    if(rawNumber.length > 0){
      inputTitle.classList.add('hidden');
    } else {
      inputTitle.classList.remove('hidden');
    }

    // Remove previous classes
    displayText.classList.remove('valid', 'invalid');
    displayContainer.classList.remove('valid', 'invalid');
    hint.classList.remove('valid', 'invalid');

    if(isValidNumber(formattedNumber)){
      hint.textContent = "Правильно! Теперь нажми на зелёную кнопку.";
      hint.classList.add('valid');
      displayContainer.classList.add('valid');
      displayText.classList.add('valid');
    } else if(rawNumber.length > 0 && !isIncorrectSoFar(formattedNumber)){
      hint.textContent = "Правильно, продолжай!";
      hint.style.color = '#969DA0';
    } else if(rawNumber.length > 0 && isIncorrectSoFar(formattedNumber)){
      hint.textContent = "Неправильно. Удали!";
      hint.classList.add('invalid');
      displayContainer.classList.add('invalid');
      displayText.classList.add('invalid');
    } else {
      hint.textContent = "";
      hint.style.color = '';
    }
  }

  buttons.forEach(button => {
    button.addEventListener('click', () => {
      const val = button.textContent;
      if(rawNumber.length < 11 && /^[0-9]$/.test(val)){
        rawNumber += val;
      }
      updateDisplay();
    });
  });

  clearButton.addEventListener('click', () => {
    if(rawNumber.length > 0){
      rawNumber = rawNumber.slice(0, -1);
    }
    updateDisplay();
  });

  callButton.addEventListener('click', () => {
    const formattedNumber = formatNumber(rawNumber);
    if(isValidNumber(formattedNumber)){
      hint.textContent = "";
      hint.classList.remove('invalid');
      hint.classList.add('valid');
      hint.style.color = '';
      displayContainer.classList.remove('invalid');
      displayContainer.classList.add('valid');
      popupOverlay.classList.add('active');
      doneVideo.currentTime = 0;
      doneVideo.play();
    } else {
      hint.textContent = 'Неправильно. Попробуй ещё раз!';
      hint.classList.add('invalid');
      hint.classList.remove('valid');
      displayContainer.classList.add('invalid');
      displayContainer.classList.remove('valid');
    }
  });

  doneVideo.addEventListener('ended', () => {
    popupOverlay.classList.remove('active');
    doneVideo.pause();
    rawNumber = '';
    updateDisplay();
  });
</script>
</body>
</html>
