<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Послушай и напечатай!</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  html, body {
    height: 100%;
    width: 100%;
    background-color: #040507;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color: #E0E0E0;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    min-height: 100vh;
    padding-left: 16px;
    padding-right: 16px;
  }
  .container {
    width: 90%;
    max-width: 400px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    flex-shrink: 0;
  }
  .small-text {
    font-size: 0.9rem;
    color: #54546A;
    margin-bottom: 12px;
    margin-top: -16px;
  }
  .large-text {
    font-weight: 700;
    font-size: 2rem;
    color: #E0E0E0;
    margin-bottom: 20px;
    white-space: nowrap;
  }
  .play-button {
    background-color: #15151B;
    border-radius: 50%;
    width: 72px;
    height: 72px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 30px;
    transition: background-color 0.3s ease;
    animation-name: pulse-scale;
    animation-duration: 2.5s;
    animation-iteration-count: infinite;
    animation-timing-function: ease-in-out;
  }
  .play-button.played, .play-button.disabled {
    animation: none !important;
  }
  .play-button:hover:not(.played):not(.disabled) {
    background-color: #1B3220;
  }
  .play-icon {
    width: 14px;
    height: 18px;
    clip-path: polygon(10% 0%, 90% 50%, 10% 100%, 10% 100%, 20% 90%, 20% 10%);
    background-color: #E0E0E0;
    border-radius: 0;
    margin-left: 2px;
  }
  .stop-icon {
    width: 14px;
    height: 14px;
    background-color: #E0E0E0;
    border-radius: 0;
  }
  @keyframes pulse-scale {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  .input-wrapper {
    position: relative;
    width: 100%;
    margin-bottom: 10px;
  }
  .input-fill {
    position: absolute;
    top: 0; left: 0; bottom: 0;
    background-color: #1B3220;
    border-radius: 6px;
    pointer-events: none;
    transition: width 0.2s ease;
    z-index: 0;
    width: 0;
    height: 100%;
  }
  input[type="text"] {
    position: relative;
    z-index: 1;
    width: 100%;
    padding: 12px 16px;
    font-size: 1.1rem;
    border-radius: 6px;
    background-color: transparent;
    color: #E0E0E0;
    outline: none;
    border: 2px solid #15151B;
  }
  input[type="text"].incorrect {
    background-color: #220D0C;
    border-color: #220D0C;
  }
  input::placeholder {
    color: #E0E0E0;
  }
  .next-task-text {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #54546A;
    min-height: 1.5em;
  }
  #next-button {
    margin-top: 20px;
    padding: 10px 28px;
    font-size: 1.1rem;
    font-weight: 400;
    border: none;
    border-radius: 6px;
    background-color: #15151B;
    color: #E0E0E0;
    cursor: pointer;
    display: none;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #next-button:hover:not(:disabled) {
    background-color: #1B3220;
  }
  #next-button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  .home-link-container {
    margin-top: 4px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    flex-shrink: 0;
  }
  .home-link {
    color: #262930;
    text-decoration: none;
    font-size: 1.1em;
    transition: color 0.3s ease;
    cursor: pointer;
  }
  .home-link:hover,
  .home-link:focus {
    color: #363940;
    text-decoration: underline;
  }
  @media (max-width: 480px) {
    html, body {
      padding-left: 16px;
      padding-right: 16px;
    }
  }
</style>
</head>
<body>
  <main class="container" role="main">
    <div id="task-number" class="small-text">Задание 1</div>
    <div id="task-prompt" class="large-text" aria-live="polite">Послушай и напечатай!</div>
    <button id="play-btn" class="play-button" aria-label="Воспроизвести звук">
      <div id="play-icon" class="play-icon"></div>
    </button>
    <div class="input-wrapper" aria-live="polite">
      <div id="input-fill" class="input-fill"></div>
      <input
        type="text"
        id="input-field"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="off"
        spellcheck="false"
        aria-describedby="task-number"
        placeholder="Напечатай здесь..."
        aria-invalid="false"
      />
    </div>
    <div id="next-task" class="next-task-text"></div>
    <button id="next-button" type="button" aria-label="Перейти к следующему заданию">Дальше</button>
  </main>
  <footer class="home-link-container" role="contentinfo" id="footer-link">
    <a href="index.html" class="home-link">Вернуться к другим заданиям</a>
  </footer>
<script>
  const tasks = [
    { phrase: 'в понедельник я пойду в школу', audioSrc: 'entersentence/voice1.mp3', taskLabel: 'Задание 1', prompt: 'Послушай и напечатай!' },
    { phrase: 'зимой на улице холодно', audioSrc: 'entersentence/voice2.mp3', taskLabel: 'Задание 2', prompt: 'Послушай и напечатай!' },
    { phrase: 'ночью за окном темно', audioSrc: 'entersentence/voice3.mp3', taskLabel: 'Задание 3', prompt: 'Послушай и напечатай!' },
    { phrase: 'руки надо мыть с мылом', audioSrc: 'entersentence/voice4.mp3', taskLabel: 'Задание 4', prompt: 'Послушай и напечатай!' },
    { phrase: 'я слушаю музыку в наушниках', audioSrc: 'entersentence/voice5.mp3', taskLabel: 'Задание 5', prompt: 'Послушай и напечатай!' },
    { phrase: 'зелёный мячик укатился под диван', audioSrc: 'entersentence/voice6.mp3', taskLabel: 'Задание 6', prompt: 'Послушай и напечатай!' },
    { phrase: 'мы идём в парк кормить уток', audioSrc: 'entersentence/voice7.mp3', taskLabel: 'Задание 7', prompt: 'Послушай и напечатай!' },
    { phrase: 'я мою руки когда прихожу с улицы', audioSrc: 'entersentence/voice8.mp3', taskLabel: 'Задание 8', prompt: 'Послушай и напечатай!' },
    { phrase: 'мы едем на электричке к бабушке', audioSrc: 'entersentence/voice9.mp3', taskLabel: 'Задание 9', prompt: 'Послушай и напечатай!' },
    { phrase: 'я люблю играть в игры на компьютере', audioSrc: 'entersentence/voice10.mp3', taskLabel: 'Задание 10', prompt: 'Послушай и напечатай!' }
  ];

  const successAudio = new Audio('entersentence/success.mp3');

  let currentTaskIndex = 0;
  const taskNumberElem = document.getElementById("task-number");
  const taskPromptElem = document.getElementById("task-prompt");
  const playBtn = document.getElementById("play-btn");
  const playIconDiv = document.getElementById("play-icon");
  const inputField = document.getElementById("input-field");
  const inputFill = document.getElementById("input-fill");
  const nextTaskElem = document.getElementById("next-task");
  const nextButton = document.getElementById("next-button");
  const footerLink = document.getElementById("footer-link");

  const audio = new Audio();

  function loadTask(index) {
    const task = tasks[index];
    taskNumberElem.textContent = task.taskLabel;
    taskPromptElem.textContent = task.prompt;
    inputField.value = "";
    inputField.classList.remove("incorrect");
    inputFill.style.width = "0";
    inputField.disabled = false;
    nextButton.style.display = "none";
    nextTaskElem.textContent = "";
    inputField.setAttribute("aria-invalid", "false");
    inputField.focus();

    audio.src = task.audioSrc;
    audio.load();

    playBtn.classList.remove("played", "disabled");
    showPlayIcon();

    // При загрузке задания ссылка всегда видима
    footerLink.style.display = "block";
  }

  function showPlayIcon() {
    playIconDiv.className = "play-icon";
  }

  function showStopIcon() {
    playIconDiv.className = "stop-icon";
  }

  playBtn.addEventListener("click", () => {
    if (audio.paused) {
      audio.currentTime = 0;
      audio.play()
        .then(() => {
          showStopIcon();
          playBtn.classList.add("played");
        })
        .catch((e) => console.error("Ошибка воспроизведения аудио:", e));
    } else {
      audio.pause();
      audio.currentTime = 0;
      showPlayIcon();
      playBtn.classList.add("played");
    }
  });

  audio.addEventListener("ended", () => {
    showPlayIcon();
    playBtn.classList.add("played");
  });

  function updateFillWidth(entered, expected) {
    let percent = 0;
    if (entered.length > 0)
      percent = Math.min(entered.length / expected.length, 1);
    if (entered === expected) percent = 1;
    inputFill.style.width = percent * 100 + "%";
  }

  inputField.addEventListener("input", () => {
    const entered = inputField.value.toLowerCase();
    const expected = tasks[currentTaskIndex].phrase.toLowerCase();

    updateFillWidth(entered, expected);

    if (expected.startsWith(entered)) {
      inputField.classList.remove("incorrect");
      inputField.setAttribute("aria-invalid", "false");

      if (entered === expected) {
        nextTaskElem.textContent = "";
        nextButton.style.display = "inline-block";

        // Скрываем ссылку ТОЛЬКО в момент показа кнопки "Дальше"
        footerLink.style.display = "none";

        successAudio.currentTime = 0;
        successAudio.play().catch((e) =>
          console.error("Ошибка воспроизведения success аудио:", e)
        );
      } else {
        nextButton.style.display = "none";
        footerLink.style.display = "block";
        nextTaskElem.textContent = "";
      }
    } else {
      inputField.classList.add("incorrect");
      inputField.setAttribute("aria-invalid", "true");
      nextButton.style.display = "none";
      footerLink.style.display = "block";
      nextTaskElem.textContent = "";
    }
  });

  nextButton.addEventListener("click", () => {
    currentTaskIndex++;
    if (currentTaskIndex < tasks.length) {
      loadTask(currentTaskIndex);
    } else {
      nextTaskElem.textContent = "Конец!";
      inputField.disabled = true;
      playBtn.disabled = true;
      nextButton.style.display = "none";
      inputFill.style.width = "0";
      showPlayIcon();
      playBtn.classList.add("disabled");

      // Показываем ссылку в конце
      footerLink.style.display = "block";
    }
  });

  loadTask(currentTaskIndex);
</script>
</body>
</html>
